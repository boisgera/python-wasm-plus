#!/bin/bash
export PYTHONDONTWRITEBYTECODE=1

REBUILD=${REBUILD:-false}

ROOT=${ROOT:-$(pwd)}
HOST_PREFIX=${HOST_PREFIX:-$ROOT/devices/$(arch)/usr}
PREFIX=${PREFIX:-${ROOT}/devices/emsdk/usr}

PYTHON_FOR_BUILD=${PYTHON_FOR_BUILD:-${HOST_PREFIX}/bin/python3}

PYTHONPYCACHEPREFIX="$(realpath ${ROOT}/build/pycache)"

#stable
EMFLAVOUR=latest
#git
EMFLAVOUR=tot

PYDK_PYTHON_HOST_PLATFORM=wasm32-$EMFLAVOUR-emscripten

if echo $LD_LIBRARY_PATH |grep -q ${HOST}/lib
then
    # config already set
    echo -n
else
    export LD_LIBRARY_PATH="${HOST_PREFIX}/lib:$LD_LIBRARY_PATH"
fi

if [[ ! -z ${PYDK+z} ]]
then
    # config already set
    echo -n
else
    mkdir -p src
    export PKG_CONFIG_PATH="${PREFIX}/lib/pkgconfig"
    export PATH="${HOST_PREFIX}/bin:$PATH"
    export PYDK=minimal
fi
